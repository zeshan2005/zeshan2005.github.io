<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Holiday Explorer - Holidays</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >
</head>
<body onload="loadCountriesIntoSelect()">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="index.html">Holiday Explorer</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav" aria-controls="navbarNav"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="countries.html">Countries</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="holidays.html">Holidays</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


<div class="container py-4">
    <h1 class="mb-3">Find Holidays</h1>
    <p class="mb-3">
        This page uses the HolidayAPI <strong>/countries</strong> and
        <strong>/holidays</strong> endpoints to show public holidays.
    </p>


    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <label for="countrySelect" class="form-label">Country</label>
            <select id="countrySelect" class="form-select">
                <option value="">Loading countries...</option>
            </select>
        </div>


        <div class="col-md-3">
            <label class="form-label">Year</label>
            <input
                type="number"
                class="form-control"
                value="2024"
                readonly
            >
        </div>


        <div class="col-md-3 d-flex align-items-end">
            <button class="btn btn-primary w-100" onclick="loadHolidays()">
                Load Holidays
            </button>
        </div>
    </div>


    <div id="status" class="mb-3 text-muted">
        Countries are loading...
    </div>


    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
            <tr>
                <th style="width: 160px;">Date</th>
                <th>Name</th>
            </tr>
            </thead>
            <tbody id="holidaysTableBody">
            </tbody>
        </table>
    </div>
</div>


<script>
    var API_KEY = "fa700f81-9485-4642-84f7-f6827a6252bc";


    var API_BASE = "https://holidayapi.com/v1";
    var FIXED_YEAR = 2024; 


    function loadCountriesIntoSelect() {
        var select = document.getElementById("countrySelect");
        var status = document.getElementById("status");


        select.innerHTML = '<option value="">Loading countries...</option>';
        status.textContent = "Loading countries...";


        var url = API_BASE + "/countries?key=" + encodeURIComponent(API_KEY);
        console.log("Requesting countries:", url);


        fetch(url)
            .then(function (response) {
                console.log("Countries HTTP status:", response.status);
                return response.text().then(function (text) {
                    if (!response.ok) {
                        throw new Error("HTTP " + response.status + " - " + text);
                    }
                    return JSON.parse(text);
                });
            })
            .then(function (data) {
                console.log("Countries JSON:", data);


                if (!data.countries || data.countries.length === 0) {
                    status.textContent = "No countries returned.";
                    select.innerHTML =
                        '<option value="">No countries available</option>';
                    return;
                }


                select.innerHTML = "";
                var placeholder = document.createElement("option");
                placeholder.value = "";
                placeholder.textContent = "Select a country...";
                select.appendChild(placeholder);


                data.countries.forEach(function (c) {
                    var opt = document.createElement("option");
                    opt.value = c.code;
                    opt.textContent = c.code + " - " + c.name;
                    select.appendChild(opt);
                });


                status.textContent = "Countries loaded. Choose a country and load holidays.";
            })
            .catch(function (error) {
                console.error("Countries fetch error:", error);
                status.textContent = "Error loading countries: " + error.message;
                select.innerHTML =
                    '<option value="">Error loading countries</option>';
            });
    }


    function loadHolidays() {
        var select = document.getElementById("countrySelect");
        var status = document.getElementById("status");
        var tbody  = document.getElementById("holidaysTableBody");


        var country = select.value;
        var year    = FIXED_YEAR;


        if (!country) {
            alert("Please select a country.");
            return;
        }


        status.textContent =
            "Loading holidays for " + country + " in " + year + "...";
        tbody.innerHTML = "";


        var url = API_BASE + "/holidays"
            + "?key=" + encodeURIComponent(API_KEY)
            + "&country=" + encodeURIComponent(country)
            + "&year=" + year;


        console.log("Requesting holidays:", url);


        fetch(url)
            .then(function (response) {
                console.log("Holidays HTTP status:", response.status);
                return response.text().then(function (text) {
                    if (!response.ok) {
                        throw new Error("HTTP " + response.status + " - " + text);
                    }
                    return JSON.parse(text);
                });
            })
            .then(function (data) {
                console.log("Holidays JSON:", data);


                var holidays = data.holidays;
                if (!holidays || holidays.length === 0) {
                    status.textContent =
                        "No holidays found for " + country + " in " + year + ".";
                    return;
                }


                holidays.forEach(function (h) {
                    var tr = document.createElement("tr");


                    var tdDate = document.createElement("td");
                    tdDate.textContent = h.date || "";


                    var tdName = document.createElement("td");
                    tdName.textContent = h.name || "";


                    tr.appendChild(tdDate);
                    tr.appendChild(tdName);
                    tbody.appendChild(tr);
                });


                status.textContent = "Found " + holidays.length + " holidays.";
            })
            .catch(function (error) {
                console.error("Holidays fetch error:", error);
                status.textContent =
                    "Error loading holidays: " + error.message;
            });
    }
</script>


<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
</script>
</body>
</html>
